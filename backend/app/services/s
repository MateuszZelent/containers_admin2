ker2/mumax_container.sif code-server --disable-telemetry --log debug "$SINIMAGE_DIR"\n\n''#!/bin/bash\n#SBATCH --job-name="container_asdasdasd"\n#SBATCH --output=asdasdasd-%x.%J.%N.out\n#SBATCH --ntasks=1\n#SBATCH --tasks-per-node=1\n#SBATCH --cpus-per-task=1\n#SBATCH --time=24:00:00\n#SBATCH --mem=1G\n#SBATCH --gres=gpu:0\n#SBATCH --partition=proxima\n#SBATCH --export=ALL,SINGULARITYENV_SINIMAGE_DIR="/mnt/local/kkingstoun/admin",SINGULARITYENV_CODE_SERVER_WORKSPACE="/mnt/local/kkingstoun/admin"\n\n### 1. Definiowanie "użytkownika" i katalogu docelowego\nlocalusername="admin"\nUSERNAME="kkingstoun"\nSINIMAGE_DIR="/mnt/local/$USERNAME/$localusername"\nexport SINIMAGE_DIR\nNEW_PORT=8682\n\n\nif [ "$localusername" == "admin"]; then\n    echo "Zmienna localusername jest ustawiona na: $localusername"\nelse\n    echo "Zmienna localusername nie jest poprawnie ustawiona!"\nfi\ntarget_dir="/mnt/storage_3/home/kkingstoun/new_home/containers2/$localusername"\nCONFIG_FILE="$target_dir/code-server/config.yaml"\n\necho "Zmienna target_dir jest ustawiona na: $target_dir"\necho "Zmienna SINIMAGE_DIR jest ustawiona na: $SINIMAGE_DIR"\necho "Zmienna USERNAME jest ustawiona na: $USERNAME"\necho "Zmienna localusername jest ustawiona na: $localusername"\necho "Zmienna XDG_RUNTIME_DIR jest ustawiona na: $XDG_RUNTIME_DIR"\necho "Zmienna NEW_PORT jest ustawiona na: $NEW_PORT"\necho "Zmienna NEW_PASSWORD jest ustawiona na: $NEW_PASSWORD"\necho "Zmienna CONFIG_FILE jest ustawiona na: $CONFIG_FILE"\n\n### 2. Tworzenie folderu i kopiowanie wzorcowej zawartości\nif [ -d "$target_dir" ] && [ "$(ls -A $target_dir)" ]; then\n    echo "Katalog $target_dir już istnieje i nie jest pusty - kontener jest reaktywowany"\nelse\n    echo "Tworzenie nowego katalogu kontenera i kopiowanie plików wzorcowych..."\n    mkdir -p "$target_dir"\n    cp -r /mnt/storage_3/home/kkingstoun/new_home/amu_container_env/docker2/container_example/* "$target_dir"\nfi\n\n# # Definiowanie nowego portu i hasła\n\nif [ -z "$USERNAME" ]; then\n    echo "Błąd: Zmienna USERNAME nie została ustawiona!"\n    exit 1\nfi\n\nif [ -z "$SINIMAGE_DIR" ]; then\n    echo "Błąd: Zmienna SINIMAGE_DIR nie została ustawiona!"\n    exit 1\nfi\n\n# Sprawdzenie, czy plik config.yaml istnieje, jeśli nie - tworzymy nowy\nif [ ! -f "$CONFIG_FILE" ]; then\n    echo "Plik $CONFIG_FILE nie istnieje. Tworzenie nowego..."\n    mkdir -p "$(dirname "$CONFIG_FILE")" || { echo "Błąd tworzenia katalogu dla $CONFIG_FILE"; exit 1; }\n    cat <<EOL > "$CONFIG_FILE"\nbind-addr: 0.0.0.0:$NEW_PORT\npassword: abecadlo1234\nauth: password\nEOL\nelse\n    echo "Modyfikacja istniejącego pliku $CONFIG_FILE..."\n    sed -i "s|^bind-addr: .*|bind-addr: 0.0.0.0:$NEW_PORT|" "$CONFIG_FILE"\n    sed -i "s|^password: .*|password: $NEW_PASSWORD|" "$CONFIG_FILE"\n    sed -i "s|^auth: .*|auth: password|" "$CONFIG_FILE"\n    echo "Zaktualizowano plik $CONFIG_FILE."\nfi\n\n\n\n# Tworzymy katalog docelowy w SINIMAGE_DIR (jeśli nie istnieje)\nmkdir -p $SINIMAGE_DIR\nmkdir -p $SINIMAGE_DIR/.config\nmkdir -p $SINIMAGE_DIR/.local/cache/conda\nmkdir -p $SINIMAGE_DIR/.local/share/jupyter/runtime\nmkdir -p $SINIMAGE_DIR/.local/share/ipython\nmkdir -p $SINIMAGE_DIR/.local/etc/jupyter\nmkdir -p $SINIMAGE_DIR/.local/share/jupyter\nmkdir -p $SINIMAGE_DIR/.local/share/matplotlib\nmkdir -p $SINIMAGE_DIR/.local/cache\nmkdir -p $SINIMAGE_DIR/.local/etc/code-server\nmkdir -p $SINIMAGE_DIR/zfn_storage/mannga\n# # Załadowanie modułu obsługi GPU (jeśli to wymagane na klastrze)\nmodprobe nvidia_uvm || echo "Nie udało się załadować nvidia_uvm (może nie być potrzebne)"\nmkdir -p "$SINIMAGE_DIR/.local/run"\nchmod 700 "$SINIMAGE_DIR/.local/run"\n\nexport XDG_RUNTIME_DIR="$SINIMAGE_DIR/.runtime"\nmkdir -p "$XDG_RUNTIME_DIR"\nchmod 700 "$XDG_RUNTIME_DIR"\n\nrclone mount \\\n    --daemon \\\n    -vv \\\n    --fast-list \\\n    --stats=1h \\\n    --checkers=100 \\\n    --uid=1000 \\\n    --dir-perms=0777 \\\n    --gid=1000 \\\n    --attr-timeout=1s \\\n    --dir-cache-time=5m \\\n    --poll-interval=1m0s \\\n    --cache-db-purge \\\n    --cache-dir=/tmp/rclone \\\n    --vfs-cache-poll-interval=1m \\\n    --vfs-cache-max-age=1h0m0s \\\n    --vfs-cache-max-size=0 \\\n    --vfs-cache-mode=writes \\\n    --allow-non-empty \\\n    --buffer-size=16M \\\n    --max-read-ahead=128k \\\n    --vfs-read-chunk-size=50K \\\n    --vfs-read-chunk-size-limit=128M \\\n    zfn2:/mnt/zfn2/zfn2/mannga $SINIMAGE_DIR/zfn_storage/mannga &\n\n\n\nif [ -f "$CONFIG_FILE_PATH" ]; then\n    echo "Displaying contents of $CONFIG_FILE_PATH:"\n    cat "$CONFIG_FILE_PATH"\nelse\n    echo "File $CONFIG_FILE_PATH does not exist!"\nfi\n\n### 4. Uruchomienie kontenera Singularity\nsingularity run \\\n  --nv \\\n  --no-home \\\n  --env SINIMAGE_DIR="$SINIMAGE_DIR" \\\n  --env CODE_SERVER_WORKSPACE="$SINIMAGE_DIR" \\\n  --env XDG_RUNTIME_DIR="$XDG_RUNTIME_DIR" \\\n  --env VSCODE_IPC_HOOK_CLI="" \\\n  --env CODE_SERVER_CONFIG=$SINIMAGE_DIR/.local/etc/code-server/config.yaml\n  --bind "$SINIMAGE_DIR":"$SINIMAGE_DIR":rw \\\n  --bind "/mnt/storage_3/home/kkingstoun/pl0095-01/scratch/zelent/plus":"$SINIMAGE_DIR/pcss_storage/mumax_plus":rw \\\n  --bind "/mnt/storage_3/home/kkingstoun/pl0095-01/scratch/zelent/mannga":"$SINIMAGE_DIR/pcss_storage/mannga":rw \\\n  --bind "/mnt/storage_2/scratch/pl0095-01/zelent/golebiewski/":"$SINIMAGE_DIR/pcss_storage/manga_golebiewski_folder":rw \\\n  --bind "/mnt/storage_3/home/kkingstoun/new_home/amu_container_env/docker2/.zshrc":"$SINIMAGE_DIR/.zshrc":rw \\\n  --bind "$target_dir/starship.toml":"$SINIMAGE_DIR/.config/starship.toml":rw \\\n  --bind "$CONFIG_FILE":"$SINIMAGE_DIR/.local/etc/code-server/config.yaml":rw \\\n  --bind "$target_dir/code-server/.local/share/code-server":"$SINIMAGE_DIR/.local/share/code-server":rw \\\n  --bind "$target_dir/code-server/settings.json":"$SINIMAGE_DIR/.local/share/code-server/User/settings.json":rw \\\n  --bind "/mnt/storage_3/home/kkingstoun/new_home/amu_container_env/docker2/entrypoint.sh":"/software/entrypoint.sh":ro \\\n  --bind "/mnt/storage_3/home/kkingstoun/new_home/amu_container_env/docker2/entrypoint.sh":"/mnt/storage_3/home/kkingstoun/new_home/amu_container_env/docker2/entrypoint.sh" \\\n  /mnt/storage_3/home/kkingstoun/new_home/amu_container_env/doc